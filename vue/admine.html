<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>RegistrationForm_v7 by Colorlib</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- MATERIAL DESIGN ICONIC FONT -->
	<link rel="stylesheet" href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">

	<!-- STYLE CSS -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/tailwindcss.css" />
	<style>
		table, th, td {
		  border: 1px solid black;
		  border-collapse: collapse;
		  color: black;
		}
		
		table.center {
		  margin-left: auto; 
		  margin-right: auto;
		}
		</style>
</head>

<body>
	<!-- Nav-bar -->
	<nav class="bg-green-600 block w-screen flex items-center justify-between flex-grow space-x-10 px-4 py-5 lg:p-5">
		<!-- Dorp -->
		<div class="relative">
			<div>
				<a href="http://127.0.0.1:7000/catogery"> <button id="menu-dwn"
						class="flex items-center space-x-2 lg:space-x-5 text-xl lg:text-3xl text-gray-100 lg:p-5 block hover:bg-green-700 duration-300">
						Category
					</button> </a>
			</div>
		</div>
		<!-- home -->
		<div
			class="flex items-center space-x-2 lg:space-x-5 text-xl lg:text-3xl text-gray-100 lg:p-5 block hover:bg-green-700 duration-300">
			<svg class="w-5 h-5 lg:w-10 lg:h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
					d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
				</path>
			</svg>
			<a href="http://127.0.0.1:7000/book">Home</a>
		</div>
		<!-- login -->
		<div
			class="text-xl lg:text-3xl text-gray-100 lg:p-5 block hover:bg-green-700 duration-300 flex items-center lg:mx-2 space-x-2 lg:space-x-5">
			<svg class="w-5 h-5 lg:w-10 lg:h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
					d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1">
				</path>
			</svg>
			<button href="#" onclick="deletjwt()"> Logout</button>
		</div>
		<div class=" bg-gray-200">
			<div class="container  flex justify-center items-center">
				<div class="relative">
					<div class="absolute top-4 left-3"> <i
							class="fa fa-search text-gray-400 z-20 hover:text-gray-500"></i> </div>
					<input type="text" class="h-14 w-96 pl-10 pr-20 rounded-lg z-0 focus:shadow focus:outline-none"
						placeholder="Search anything..." id="search">
					<div class="absolute top-2 right-2"> <button
							class="h-10 w-20 text-white rounded-lg bg-green-600 hover:bg-green-200"
							onclick="ser()">Search</button> </div>
				</div>
			</div>
		</div>
	</nav>
	<!-- body -->
	<div>
		<div class="inner">
			<div>
				<h3>libry</h3>
				<p>Please enter all fields and confirm the entered information before entering. Thank you</p>
				<label class="form-group">
					<input type="text" class="form-control" id="catn" required>
					<span>Category Name</span>
					<span class="border"></span>
				</label>
				<label class="form-group">
					<input type="text" class="form-control" id="bookn" required>
					<span for="">book Name</span>
					<span class="border"></span>
				</label>
				<label class="form-group">
					<input type="number" class="form-control" id="booky" required>
					<span for="">book year</span>
					<span class="border"></span>
				</label>
				<label class="form-group">
					<input type="number" class="form-control" id="booknum" required>
					<span for="">Number of Pages</span>
					<span class="border"></span>
				</label>
				<label class="form-group">
					<textarea class="form-control" id="bookdesc" required></textarea>
					<span for="">Book Description</span>
					<span class="border"></span>
				</label>
				<label class="form-group">
					<textarea class="form-control" id="bookind" required></textarea>
					<span for="">Ispn</span>
					<span class="border"></span>
				</label>
				<input type="file" id="imageInput">
				<label class="form-group">
					<input type="text" class="form-control" id="authorn" required>
					<span for="">Author Name</span>
					<span class="border"></span>
				</label>


				<button type="submit" onclick="loginForm()">Submit
					<i class="zmdi zmdi-arrow-right"></i>
				</button>
			</div>
		</div>
	</div>
	<div class="flex justify-center	my-10">
		<h1 class="text-3xl	text-green-600	">Delivery</h1>
	</div>
	
			<table class="center">
				<thead>
					<tr>
						<th >Name</th>
						<th >book</th>
						<th >location</th>
					</tr>
				</thead>
				<tbody id="delver">

				</tbody>
			</table>
		
	<script>
		var delvery2 = document.getElementById("delver");
		fetch('http://127.0.0.1:7000/getdelvery')
			.then(response => response.json())
			.then((post) => {

				console.log(post.resrvation)
				for (let i = 0; i < post.resrvation.length; i++) {
					delvery2.innerHTML += `
<tr>
					<td >${post.resrvation[i].user_name}</td>
					<td>${post.resrvation[i].book_name}</td>
					<td>${post.resrvation[i].user_stahen}</td>
				</tr>
`
				}

			})

		var docCookies = {
			getItem: function (sKey) {
				return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, "\\$&") + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) || null;
			},
			setItem: function (sKey, sValue, vEnd, sPath, sDomain, bSecure) {
				if (!sKey || /^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)) { return false; }
				var sExpires = "";
				if (vEnd) {
					switch (vEnd.constructor) {
						case Number:
							sExpires = vEnd === Infinity ? "; expires=Fri, 31 Dec 9999 23:59:59 GMT" : "; max-age=" + vEnd;
							break;
						case String:
							sExpires = "; expires=" + vEnd;
							break;
						case Date:
							sExpires = "; expires=" + vEnd.toUTCString();
							break;
					}
				}
				document.cookie = encodeURIComponent(sKey) + "=" + encodeURIComponent(sValue) + sExpires + (sDomain ? "; domain=" + sDomain : "") + (sPath ? "; path=" + sPath : "") + (bSecure ? "; secure" : "");
				return true;
			},
			removeItem: function (sKey, sPath, sDomain) {
				if (!sKey || !this.hasItem(sKey)) { return false; }
				document.cookie = encodeURIComponent(sKey) + "=; expires=Thu, 01 Jan 1970 00:00:00 GMT" + (sDomain ? "; domain=" + sDomain : "") + (sPath ? "; path=" + sPath : "");
				return true;
			},
			hasItem: function (sKey) {
				return (new RegExp("(?:^|;\\s*)" + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, "\\$&") + "\\s*\\=")).test(document.cookie);
			},
			keys: /* optional method: you can safely remove it! */ function () {
				var aKeys = document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g, "").split(/\s*(?:\=[^;]*)?;\s*/);
				for (var nIdx = 0; nIdx < aKeys.length; nIdx++) { aKeys[nIdx] = decodeURIComponent(aKeys[nIdx]); }
				return aKeys;
			}
		};


		const loginForm = async () => {


			function parseJwt(token) {
				var base64Url = token.split('.')[1];
				var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
				var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
					return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
				}).join(''));

				return JSON.parse(jsonPayload);
			};
			var user_id = parseJwt(docCookies.getItem("tooken"))
			user = user_id.id
			console.log(user)



			const toBase64 = file => new Promise((resolve, reject) => {
				const reader = new FileReader();
				reader.readAsDataURL(file);
				reader.onload = () => resolve(reader.result);
				reader.onerror = error => reject(error);
			});
			var image = document.getElementById('imageInput').files;
			var testArray = [];
			for (let i = 0; i < image.length; ++i) {
				testArray.push(await toBase64(image[i]));
			}
			console.log(testArray)

			let CategoryName = document.getElementById('catn').value;
			let bookName = document.getElementById('bookn').value;
			let bookyer = document.getElementById('booky').value;
			let booknumber = document.getElementById('booknum').value;
			let BookDescription = document.getElementById('bookdesc').value;
			let BookIndex = document.getElementById('bookind').value;
			let autherName = document.getElementById('authorn').value;

			console.log(BookIndex)
			const loginData = {
				categoryName: CategoryName,
				name_book: bookName,
				year_book: bookyer,
				isbn: BookIndex,
				user_id: user,
				numper_book: booknumber,
				dec_book: BookDescription,
				book_image: testArray,
				authorName: autherName
			}
			const options = {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(loginData)

			}
			fetch('http://127.0.0.1:7000/category', options)
			console.log(options);
		}
		function ser() {
			var values1 = document.getElementById("search").value
			console.log(values1)
			window.location.replace(`http://127.0.0.1:7000/searche?myVar1=${values1}`);

		}
		function check(e) {
			const currentTarget = e.currentTarget.id
			console.log(currentTarget)
			fetch(`http://127.0.0.1:7000/deletresvation/${currentTarget}`)
			console.log(options);

		}
		function deletjwt() {
			docCookies.removeItem("tooken")
			window.location.replace("http://127.0.0.1:7000/");

		}
	</script>
</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>